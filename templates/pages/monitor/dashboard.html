{{ define "pages/monitor/dashboard.html" }}
{{template "layouts/auth.html" .}}

{{define "page_content"}}
<div class="space-y-6">
    <!-- Header -->
    <div>
        <h1 class="text-xl font-semibold text-gray-900">System Monitor</h1>
        <p class="mt-1 text-sm text-gray-600">Real-time system performance metrics and monitoring.</p>
    </div>

    <!-- System Stats -->
    <div id="system-stats" 
         hx-get="/monitor/api/stats" 
         hx-trigger="load, every 5s"
         hx-indicator="#loading-indicator">
        <!-- Stats will be loaded here via HTMX -->
        <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
            <!-- Loading placeholders -->
            <div class="bg-white overflow-hidden shadow rounded-lg animate-pulse">
                <div class="p-5">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-gray-200 rounded-full"></div>
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <div class="h-4 bg-gray-200 rounded w-16 mb-2"></div>
                            <div class="h-6 bg-gray-200 rounded w-12"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white overflow-hidden shadow rounded-lg animate-pulse">
                <div class="p-5">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-gray-200 rounded-full"></div>
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <div class="h-4 bg-gray-200 rounded w-16 mb-2"></div>
                            <div class="h-6 bg-gray-200 rounded w-12"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white overflow-hidden shadow rounded-lg animate-pulse">
                <div class="p-5">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-gray-200 rounded-full"></div>
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <div class="h-4 bg-gray-200 rounded w-16 mb-2"></div>
                            <div class="h-6 bg-gray-200 rounded w-12"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white overflow-hidden shadow rounded-lg animate-pulse">
                <div class="p-5">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-gray-200 rounded-full"></div>
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <div class="h-4 bg-gray-200 rounded w-16 mb-2"></div>
                            <div class="h-6 bg-gray-200 rounded w-12"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Process List -->
    <div class="bg-white shadow sm:rounded-lg">
        <div class="px-4 py-5 sm:p-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Running Processes</h3>
            <div id="process-list" 
                 hx-get="/monitor/api/processes" 
                 hx-trigger="load, every 10s"
                 hx-indicator="#loading-indicator">
                <!-- Process list will be loaded here via HTMX -->
                <div class="animate-pulse">
                    <div class="space-y-3">
                        <div class="h-4 bg-gray-200 rounded w-full"></div>
                        <div class="h-4 bg-gray-200 rounded w-5/6"></div>
                        <div class="h-4 bg-gray-200 rounded w-4/6"></div>
                        <div class="h-4 bg-gray-200 rounded w-3/6"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Information -->
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
        <!-- Host Information (will be populated by HTMX) -->
        <div class="bg-white shadow sm:rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Host Information</h3>
                <div id="host-info">
                    <!-- Will be populated via HTMX -->
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-white shadow sm:rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Quick Actions</h3>
                <div class="space-y-3">
                    <button onclick="refreshStats()" class="w-full text-left flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <i class="fas fa-sync-alt mr-3 text-gray-400"></i>
                        Refresh All Data
                    </button>
                    <a href="/dashboard" class="w-full text-left flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <i class="fas fa-tachometer-alt mr-3 text-gray-400"></i>
                        Return to Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function refreshStats() {
        htmx.trigger('#system-stats', 'refresh');
        htmx.trigger('#process-list', 'refresh');
        
        // Show a brief notification
        const notification = document.createElement('div');
        notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
        notification.textContent = 'Data refreshed';
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 2000);
    }

    // Update timestamp every second
    setInterval(function() {
        const timestamps = document.querySelectorAll('.timestamp');
        timestamps.forEach(function(element) {
            const now = new Date();
            element.textContent = 'Last updated: ' + now.toLocaleTimeString();
        });
    }, 1000);
</script>
{{end}}